#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# title-cleaner.py: remove cruft from titles of web pages like website name/domain or error messages
# Author: Gwern Branwen
# Date: 2024-06-11
# When:  Time-stamp: "2024-08-18 21:22:50 gwern"
# License: CC-0
#
# Usage: $ OPENAI_API_KEY="sk-XXX" xclip -o | python title-cleaner.py
#
# When scraping HTML web pages, using the <title> field naively gives bad results: many are covert error pages, or a fixed site-wide constant string, or uselessly vague/short, or prepend/postpend the site URL or the site name or a whole variety of bizarre things.
# Manually writing rules to clean them up turns out to be unmanageable due to the extreme long-tail of handling >20,000 URLs on gwern.net
# However, the badness in scraped titles is very much a "I know it when I see it" thing and can usually be done in isolation when looking just at the text.
# So that means it is feasible to call out to a LLM to clean up the title.

import sys
from openai import OpenAI
client = OpenAI()

if len(sys.argv) == 1:
    target = sys.stdin.read().strip()
else:
    target = sys.argv[1]

prompt = """
Task: Clean website titles parsed from <title> tags.
If a title input is useless or meaningless or an error, print out the empty string `""` instead of the original title.
If the title can be fixed, remove the junk (spam, cruft, boilerplate) from the title.
If the title looks good, then print out the original title.
If you are unsure how to fix it, then simply print out the original title.

Task examples:

1. Input title to clean: "If I Sleep for an Hour, 30 People Will Die - The New York Times"
"If I Sleep for an Hour, 30 People Will Die"
2. Input title to clean: "404"
""
3. Input title to clean: "Gwern.net | Collecting New Socks Efficiently"
"Collecting New Socks Efficiently"
4. Input title to clean: "worlds of DAVID BRIN"
""
5. Input title to clean: "steve yegge · The Amazon Memo"
"The Amazon Memo"
6. Input title to clean: "index"
""
7. Input title to clean: ""
""
8. Input title to clean: "After 92 years, millionaire miserâs heirs finally split $100M - TODAY People - TODAY.com"
After 92 years, millionaire miser’s heirs finally split $100M
9. Input title to clean: "502 Bad Gateway"
""
10. Input title to clean: "Faces2Anime: Cartoon Style Transfer in Faces using Generative Adversarial Networks. Masters Thesis 2021 @ NTUST."
"Faces2Anime: Cartoon Style Transfer in Faces using Generative Adversarial Networks"
11. Input title to clean: "articles"
""
12. Input title to clean: "Vercel Security Checkpoint"
""
13. Input title to clean: "Fan Is A Tool-Using AnimalâdConstruct Conference Talk"
"Fan Is A Tool-Using Animal"
14. Input title to clean: "CONTENTdm"
""
15. Input title to clean: "The Illustrated Retrieval Transformer â Jay Alammar â Visualizing machine learning one concept at a time."
"The Illustrated Retrieval Transformer"
16. Input title to clean: "Redirecting to https://now.tufts.edu/2016/07/14/moderately-reducing-calories-non-obese-people-reduces-inflammation"
""
17. Input title to clean: "Not Found - Albion - Webflow HTML website template"
""
18. Input title to clean: "Siberian Times"
""
19. Input title to clean: "Stripe\\226\\128\\153s first carbon removal purchases\\nStripe logo\\nOpen mobile navigation\\nStripe logo\\nClose mobile navigation\\nPayments\\nCheckout\\nElements\\nRadar\\nConnect\\nBilling\\nInvoicing\\nTerminal\\nIdentity\\nClimate\\nBilling\\nInvoicing\\nTax\\nRevenue Recognition\\nSigma\\nAtlas\\nConnect\\nCapital\\nIssuing\\nTreasury\\nPayments\\nCheckout\\nElements\\nRadar\\nConnect\\nBilling\\nInvoicing\\nTerminal\\nIdentity\\nClimate\\nBilling\\nInvoicing\\nTax\\nRevenue Recognition\\nSigma\\nAtlas\\nConnect\\nCapital\\nIssuing\\nTreasury\\nStripe logo"
Stripe’s first carbon removal purchases
20. Input title to clean: "308 Permanent Redirect"
""
21. Input title to clean: "404 - Isomorphic Labs"
""
22. Input title to clean: "Page not found - PsyPost - Psychology News"
""
23. Input title to clean: "Japanese north\226\128\147south gradient in IQ predicts differences in stature, skin color, income, and homicide rate - ScienceDirect\nScienceDirect"
"Japanese north-south gradient in IQ predicts differences in stature, skin color, income, and homicide rate"
24. Input title to clean: "Notion – The all-in-one workspace for your notes, tasks, wikis, and databases."
""
25. Input title to clean: "It’s (Still) Really Hard for Robots to Autonomously Do Household Chores - IEEE Spectrum"
"It’s (Still) Really Hard for Robots to Autonomously Do Household Chores"
26. Input title to clean: "504 Gateway Time-out"
""
27. Input title to clean: "æ°æ°æ®é"
""
28. Input title to clean: "dnmarchives directory listing\nInternet Archive logo\nDonate icon\nSearch icon\nSearch icon\nUpload icon\nUser icon\nWeb icon\nTexts icon\nVideo icon\nAudio icon\nSoftware icon\nImages icon\nDonate icon\nEllipses icon\nHamburger icon\nSearch icon\nDonate icon"
"dnmarchives directory listing"
29. Input title to clean: "Page not found : Stanford University"
""
30. Input title to clean: "07"
""
31. Input title to clean: "Flashback Forum"
""
32. Input title to clean: "Stuff"
""
33. Input title to clean: "Humboldt &amp; Sonoma counties: Six arrested, 3,000 marijuana plants and 44 weapons seized in state DOJ raids - The Willits News"
Humboldt &amp; Sonoma counties: Six arrested, 3,000 marijuana plants and 44 weapons seized in state DOJ raids
34. Input title to clean: "GoLocalPDX"
""
35. Input title to clean: "Aurora’s Approach to Development. Self-driving cars are an appliedâ¦ by The Aurora Team Aurora Blog"
"Aurora’s Approach to Development. Self-driving cars are an applied"
36. Input title to clean: "An open letter to Netflix from the authors of the de-anonymization paper « 33 Bits of Entropy"
"An open letter to Netflix from the authors of the de-anonymization paper"
37. Input title to clean: "It\226\128\153s Probably Not Lithium\nspotify-podcast-badge-wht-blk-165x40"
"It’s Probably Not Lithium"
38. Input title to clean: "Scunthorpe Sans \240\159\151\175\240\159\154\171 profanity-blocking font"
"Scunthorpe Sans: a profanity-blocking font"
39. Input title to clean: "&#13;\n\tMedicine &amp; Science in Sports &amp; Exercise&#13;"
""
40. Input title to clean: "Nadia Asparouhova How to do the jhanas"
"How to do the jhanas"
41. Input title to clean: "Best-of-n with misaligned reward models for Math reasoning"
"Best-of-<em>n</em> with misaligned reward models for Math reasoning"
42. Input title to clean: "The Universe of Discourse : A potpourri of cool-looking scripts"
"A potpourri of cool-looking scripts"
43. Input title to clean: "FineWeb: decanting the web for the finest text data at scale - a Hugging Face Space by HuggingFaceFW"
"FineWeb: decanting the web for the finest text data at scale"
44. Input title to clean: "Do life hacks work? The truth is, weâll never know Psychology"
"Do life hacks work? The truth is, we’ll never know"
45. Input title to clean: "Operant Conditioning by Software Bugs – Embedded in Academia"
"Operant Conditioning by Software Bugs"
46. Input title to clean: "The dream of an alpine waterway - Swiss National Museum - Swiss history blog"
"The dream of an alpine waterway"
47. Input title to clean: "Andrew Wood The Medical School"
"Andrew Wood"
48. Input title to clean: "Reddit"
""
49. Input title to clean: "The Stigler Diet Problem �|� OR-Tools �"
"The Stigler Diet Problem"
50. Input title to clean: "why why why why why why why"
""
51. Input title to clean: "Optimized, Individualized Spaced Repetition in Hierarchical Knowledge Structures - Justin Skycak"
"Optimized, Individualized Spaced Repetition in Hierarchical Knowledge Structures"
52. Input title to clean: "Exclusive"
""
53. Input title to clean: "Patronage vs. Constituent Parties (Or Why Republican Party Leaders Matter More Than Democratic Ones) – The Scholar's Stage"
"Patronage vs. Constituent Parties (Or Why Republican Party Leaders Matter More Than Democratic Ones)"
54. Input title to clean: "Screen Media Use and Mental Health of Children and Adolescents: A Secondary Analysis of a Randomized Clinical Trial Media and Youth JAMA Network Open"
"Screen Media Use and Mental Health of Children and Adolescents: A Secondary Analysis of a Randomized Clinical Trial Media and Youth"
55. Input title to clean: "Joaquin Qui�onero Candela"
"Joaquin Quiñonero Candela"
56. "A Visual Guide to Quantization - by Maarten Grootendorst"
"A Visual Guide to Quantization"
57. "Time Use - Our World in Data"
"Time Use"
58. "The secret of Minecraft. And its challenge to the rest of us by Robin Sloan The Message"
"The secret of Minecraft. And its challenge to the rest of us"
59. "Attribution is Dying. Clicks are Dying. Marketing is Going Back to the 20th Century. - SparkToro"
"Attribution is Dying. Clicks are Dying. Marketing is Going Back to the 20th Century"
50. "Your Book Review: Real Raw News - Astral Codex Ten"
"Your Book Review: <em>Real Raw News</em>"
51. "Probably Overthinking It: There is still only one test"
"There is still only one test"
52. "Randomly updated"
""
53. "The Crystal Star Wookieepedia"
"<em>The Crystal Star</em>"
54. "Abstract Heresies: Not Lisp again...."
"Not Lisp again..."
56. "Morbid attraction to leopard urine in Toxoplasma-infected chimpanzees - ScienceDirect"
"Morbid attraction to leopard urine in <em>Toxoplasma</em>-infected chimpanzees"
57. "EP021 - Bulbapedia, the community-driven PokÃ©mon encyclopedia"
"Ep021"
58. "Your Book Review: Two Arms and a Head - Astral Codex Ten"
"Your Book Review: <em>Two Arms and a Head</em>"
59. "Your Book Review: Two Arms and a Head - Astral Codex Ten"
"Your Book Review: <em>Two Arms and a Head</em>"
60. "Redirecting"
""
61. "From Bing to Sydney – Stratechery by Ben Thompson"
"From Bing to Sydney"
62. "Seeing Centuries - by RJ Andrews - Chartography"
"Seeing Centuries"
63. "dys2p › Random Mosaic – Detecting unauthorized physical access with beans, lentils and colored rice"
"Random Mosaic – Detecting unauthorized physical access with beans, lentils and colored rice"
64. "Surely you can be serious - by Adam Mastroianni"
"Surely you can be serious"
65. "Hormonal doping and androgenization of athletes: a secret program of the German Democratic Republic government Clinical Chemistry"
"Hormonal doping and androgenization of athletes: a secret program of the German Democratic Republic government"
66. "Replacing my Right Hand with AI - Erik Schluntz"
"Replacing my Right Hand with AI"
67. "Surprising Hacker News Data Analysis — The Data Point"
"Surprising Hacker News Data Analysis"
68. "What's The Front Page of HackerNews Worth? – Terence Edenâs Blog"
"What’s The Front Page of Hacker News Worth?"
69. "Words growing or shrinking in Hacker News titles: a tidy analysis – Variance Explained"
"Words growing or shrinking in Hacker News titles: a tidy analysis"
70. "Web Page Under Construction"
""
71. "Matvoz.com – Interesting facts about when you get hit by Hacker News tsunami"
"Interesting facts about when you get hit by Hacker News tsunami"
72. "Mike Dellanoce's Blog: My first 'Hacker News Effect' experience"
"My first 'Hacker News Effect' experience"
73. "Cognitive ability and tattoos and piercings – Clear Language, Clear Mind⁠:"
"Cognitive ability and tattoos and piercings"
74. "Organization not found"
""
75. "There’s a running theme in here of programming problems LLMs solve where it’s ack..."
"There’s a running theme in here of programming problems LLMs solve where it’s..."
76. "Early evolution of small body size in Homo floresiensis"
"Early evolution of small body size in <em>Homo floresiensis</em>"
77. ""Page not found - Rybka Forum""
""
78. "Cinzel Decorative—Google Fonts"
"Cinzel Decorative"
79. "Elsie Swash Caps - Google Fonts"
"Elsie Swash Caps"
80. "Bodoni Classic Deco Caps Medium : Download For Free, View Sample Text, Rating And More On Fontsgeek.Com"
"Bodoni Classic Deco Caps Medium"
81. "Run Deep: I Put a Toaster in the Dishwasher"
"I Put a Toaster in the Dishwasher"
82. "æå­¦ããªãï¼ã¨ã´ã¡ã³ã²ãªãªã³RETAKE"
"文学フリマ＆エヴァンゲリオンRETAKE"
83. "NicolÃ¡s GÃ³mez Davila: An Anthology : Various"
"Nicolás Gómez Davila: <em>An Anthology</em>"
84. "Magyar H. P. Lovecraft PortÃ¡l"
""
85. "DE102007030495A1—Verwendung einer eine Kreatin-Komponente enthaltende Zusammensetzung zur Verbesserung der GedÃ¤chtnisleistung, der MerkfÃ¤higkeit, des LangzeitgedÃ¤chtnisses und zur Vorbeugung geistiger ErmÃ¼dungszustÃ¤nde"
"Verwendung einer eine Kreatin-Komponente enthaltende Zusammensetzung zur Verbesserung der Gedächtnisleistung, der Merkfähigkeit, des Langzeitgedächtnisses und zur Vorbeugung geistiger Ermüdungszustände"i
86. "Interview with China MiÃ©ville"
"Interview with China Miéville"
87. "Interview with Junot DÃ­az"
"Interview with Junot Díaz"
88. "Ce gÃ©nÃ©rateur de WAIFU "ThisWaifuDoesNotExist" sur le forum Blabla 18-25 ans - 20-02-2019 11:52:46 - jeuxvideo.com"
"Ce générateur de WAIFU "ThisWaifuDoesNotExist" sur le forum Blabla 18-25 ans - 20-02-2019 11:52:46 - jeuxvideo.com"
89. "Steamed Hams But It's The Confrontation From Les MisÃ©rables"
"Steamed Hams But It’s The Confrontation From <em>Les Misérables</em>"
90. "[Touhou Vocal] Raven's Jig—Une Semaine chez les Ãcarlates (Embodiment of Scarlet Devil)"
"[東方 Touhou Vocal] Raven's Jig - Une Semaine chez les Écarlates (Embodiment of Scarlet Devil)"
91. "ãæ±æ¹ Post-Metalã denshÅ«to—LÃ¦vateinn"
"【東方 Post-Metal】 denshūto - Lævateinn"
92. "2017 CODE Plenary Session 2: Susan Athey, RenÃ©e Richardson Gosline, and Ron Kohavi"
"2017 CODE Plenary Session 2: Susan Athey, Renée Richardson Gosline, and Ron Kohavi"
93. "NGE: A version of the song "Komm, sÃ¼sser Tod" will be used in _Rebuild_"
"NGE: A version of the song “Komm, süsser Tod” will be used in <em>Rebuild</em>"
94. "ramsey nasser / Yesterday's Pixels, Today"
"Yesterday’s Pixels, Today"
95. "3�Backstory"
"3. Backstory"

Task:

Input title to clean: """ + target + "\n"

completion = client.chat.completions.create(
  model="gpt-4o-mini", # we use GPT-4 because the outputs are short, we want the highest accuracy possible, we provide a lot of examples & instructions which may overload dumber models, and reviewing for correctness can be difficult, so we are willing to spend a few pennies to avoid the risk of a lower model
  messages=[
    {"role": "system", "content": "You are a researcher and web developer, compiling a bibliography."},
    {"role": "user", "content": prompt }
  ]
)

print(completion.choices[0].message.content)
